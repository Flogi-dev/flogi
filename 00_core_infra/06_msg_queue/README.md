# ë©”ì‹œì§€ í ì²˜ë¦¬ ì „ëµ (msg_queue)

## ğŸ“Œ ëª©ì 
ë³¸ ë””ë ‰í† ë¦¬ëŠ” ì´ˆê¸° ì„¤ê³„ ë‹¹ì‹œ ë©”ì‹œì§€ í ì‹œìŠ¤í…œì„ ë¶„ë¦¬ ìš´ìš©í•  ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•˜ì—¬ ìƒì„±ë˜ì—ˆìœ¼ë‚˜,  
í˜„ì¬ Flogi ì‹œìŠ¤í…œì—ì„œëŠ” `Celery + Redis` ê¸°ë°˜ì˜ ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ êµ¬ì¡°ë¡œ ì¼ì›í™”ë˜ì—ˆìŠµë‹ˆë‹¤.

> ë©”ì‹œì§€ íëŠ” "íŒŒì´í”„ë¼ì¸ ê°„ ì‹œê°„ì§€ì—°/ì˜ì¡´ì„±ì„ ëŠëŠ” êµ¬ì¡°ì  ì™„ì¶©ì§€"ì…ë‹ˆë‹¤.  
> í˜„ì¬ Flogiì˜ ëª¨ë“  ë¹„ë™ê¸° ì²˜ë¦¬ ìš”ì²­ì€ Celery Taskë¡œ ë¶„ì‚°ë˜ë©°, RedisëŠ” ê·¸ ì¤‘ê°œ ì €ì¥ì†Œ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## âœ… í˜„ì¬ ì±„íƒëœ êµ¬ì¡°

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
|-----------|------|
| **Celery** | Python ê¸°ë°˜ ë¶„ì‚° Task Queue í”„ë ˆì„ì›Œí¬ |
| **Redis** | Celeryì˜ Brokerì´ì Result Backend |
| **ì‚¬ìš© ìœ„ì¹˜** | `03_pipeline/00_celery/`, `04_mk_msg`, `06_upload` ë“±ì—ì„œ ë¹„ë™ê¸° ìš”ì²­ ì‹œ ì‚¬ìš© |
| **ë°°í¬ êµ¬ì¡°** | ì»¨í…Œì´ë„ˆ: `celery`, `redis` ë³„ë„ ë¶„ë¦¬ / `docker-compose.pipeline.yml`ì— ì •ì˜ |

---

## ğŸ§± ì²˜ë¦¬ ë‹¨ê³„ ì •ì˜ (Phase Strategy)

| Phase | êµ¬ì¡° | ì„¤ëª… |
|-------|------|------|
| Phase 0 | `BackgroundTask` (FastAPI ë‚´ì¥) | MVP ê°œë°œ ì´ˆê¸°ë‹¨ê³„. ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ ë™ê¸° ì²˜ë¦¬ |
| Phase 1 | `Celery + Redis` | í˜„ì¬ ì ìš© êµ¬ì¡°. ë‹¨ì¼ Redis ê¸°ë°˜ ë¶„ì‚° ì‘ì—… ì²˜ë¦¬ |
| Phase 2 | `Redis (shard) + Celery (scale-out)` | í•„ìš” ì‹œ Redis ë‹¤ì¤‘ ìƒ¤ë“œ êµ¬ì„±. ëŒ€ìš©ëŸ‰ ì´ë²¤íŠ¸ ì²˜ë¦¬ ëŒ€ì‘ |
| Phase 3 (ì˜ˆì •) | Kafka or RabbitMQ ë„ì… | ìŠ¤íŠ¸ë¦¬ë°/ìˆœì„œë³´ì¥/íŠ¸ëœì­ì…˜ì´ í•„ìš”í•œ ê²½ìš°ë¡œ í•œì • |

---

## ğŸ›  ìš´ì˜ ì˜ˆì‹œ

### ì˜ˆì‹œ: ë©”ì‹œì§€ ë°œì†¡ ìš”ì²­ (from mk_msg â†’ upload)

```python
from celery import shared_task
from .upload import upload_to_slack

@shared_task
def enqueue_upload(user_id: str, message_data: dict):
    upload_to_slack(user_id, message_data)
